{% extends "base.html" %}

{% block title %}Painel de Manutenção – {{ nome }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2><i class="fa-solid fa-wrench"></i> Painel de Manutenção – {{ nome }}</h2>
    <a href="{{ url_for('logout') }}" class="btn btn-outline-danger float-end mb-2">
        <i class="fa-solid fa-sign-out-alt"></i> Desconectar
    </a>
    <div class="clearfix"></div>

    <div class="card mt-3">
        <div class="card-header bg-agro text-white">
            Ordens de Serviço Abertas ({{ os_list|length }})
        </div>
        <div class="card-body">
            {% if os_list %}
            <input type="text" class="form-control mb-2" placeholder="Filtrar OS, frota, serviço..." id="filtro-os" onkeyup="filtrarOS()">
            <table class="table table-bordered table-hover" id="tabela-os">
                <thead>
                    <tr>
                        <th>OS</th>
                        <th>Frota</th>
                        <th>Serviço</th>
                        <th>Prestador</th>
                        <th>Data</th>
                        <th>Dias Abertos</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for os in os_list %}
                    <tr>
                        <td>{{ os.os }}</td>
                        <td>{{ os.frota }}</td>
                        <td>{{ os.servico }}</td>
                        <td>{{ os.prestador }}</td>
                        <td>{{ os.data }}</td>
                        <td>{{ os.dias }}</td>
                        <td>
                            <form action="{{ url_for('finalizar_os', os_numero=os.os) }}" method="post" class="d-inline">
                                <input type="hidden" name="data_finalizacao" value="{{ now.strftime('%d/%m/%Y') }}">
                                <input type="hidden" name="hora_finalizacao" value="{{ now.strftime('%H:%M') }}">
                                <button type="submit" class="btn btn-success btn-sm">
                                    <i class="fa-solid fa-check"></i> Finalizar
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
                <div class="alert alert-info">Nenhuma OS aberta no momento.</div>
            {% endif %}
        </div>
    </div>
</div>
<script>
function filtrarOS() {
    var input, filter, table, tr, td, i, j, txtValue;
    input = document.getElementById("filtro-os");
    filter = input.value.toUpperCase();
    table = document.getElementById("tabela-os");
    tr = table.getElementsByTagName("tr");
    for (i = 1; i < tr.length; i++) {
        tr[i].style.display = "none";
        td = tr[i].getElementsByTagName("td");
        for (j = 0; j < td.length; j++) {
            if (td[j]) {
                txtValue = td[j].textContent || td[j].innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    tr[i].style.display = "";
                    break;
                }
            }
        }
    }
}
</script>
{% endblock %}
